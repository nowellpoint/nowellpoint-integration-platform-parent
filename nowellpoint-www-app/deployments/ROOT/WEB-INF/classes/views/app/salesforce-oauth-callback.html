<!DOCTYPE HTML>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
    <meta name="description" content="">
    <meta name="author" content="">

    <title>${messages["application.title"]}</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css" />

    <!-- Include the CSS -->
    <link rel="stylesheet" href="/dist/toolkit-light.min.css" type="text/css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/custom.css" type="text/css" />

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">

    <script src="/js/jquery.js"></script>
    <script src="/dist/toolkit.min.js"></script>
    <script src="/js/common.js"></script>

</head>

<body>

    <br>
    <br>
    <br>
    <br>

    <div class="col-md-12 text-center">
        <div align="center-block"><i class="fa fa-4x fa-refresh fa-spin"></i></div>
        <h2>${labels["setting.up.connector"]}</h2>
    </div>

    <script>
        var hash = location.hash.replace("#", "");
        var params = {};
        hash.split('&').map(hk => {
            let temp = hk.split('=');
            params[temp[0]] = temp[1];
        });
        
        var token = {
            "id" : decodeURI(params.id),
            "access_token" : params.access_token,
            "signature" : params.signature,
            "instance_url" : params.instance_url,
            "token_type" : params.token_type,
            "issued_at" : params.issued_at
        };
        
        $.ajax({
        	type: "POST",
            url: "${links['salesforce']}/" + params.state + "/",
            dataType: "json",
            data: JSON.stringify(token),
            complete: function (response) {                
                if (response.status == 200) {
                	window.close();
                } else {
                   
                }
            }
        });

    </script>

</body>

</html>